<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Markdown â†’ PDF</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
margin:0;
height:100vh;
display:flex;
flex-direction:column;
font-family:system-ui;
}

nav{
padding:10px;
border-bottom:2px solid #000;
display:flex;
justify-content:space-between;
}

main{
flex:1;
display:flex;
}

textarea{
flex:1;
border:none;
padding:15px;
font-family:monospace;
}

iframe{
flex:1;
border:none;
background:#999;
}

button{
background:black;
color:white;
border:none;
padding:8px 15px;
}

</style>
</head>

<body>

<nav>
<input id="filename" value="document">
<button onclick="exportPDF()">Save PDF</button>
</nav>

<main>

<textarea id="editor" oninput="render()"># Hello

This preview will NEVER go dark.</textarea>

<iframe id="previewFrame"></iframe>

</main>

<script>

const iframe=document.getElementById("previewFrame");

function render(){

const doc=iframe.contentDocument;

doc.open();
doc.write(`
<!DOCTYPE html>
<html>
<head>
<style>

:root{color-scheme:light only;}

body{
margin:0;
padding:0.75in;
background:white!important;
color:black!important;
font-family:system-ui;
}

*{
background:white!important;
color:black!important;
forced-color-adjust:none;
}

h1,h2{border-bottom:1px solid black;}

table{width:100%;border-collapse:collapse;}
td,th{border:1px solid black;padding:6px;}

</style>
</head>

<body>
${marked.parse(editor.value)}
</body>
</html>
`);
doc.close();
}

async function exportPDF(){

const clone=iframe.contentDocument.body.cloneNode(true);

clone.style.background="white";
clone.style.color="black";

document.body.appendChild(clone);

await html2pdf().set({
margin:0.5,
filename:(filename.value||"doc")+".pdf",
html2canvas:{scale:2,backgroundColor:"#fff"},
jsPDF:{unit:"in",format:"letter"}
}).from(clone).save();

clone.remove();
}

render();

</script>

</body>
</html>