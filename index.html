<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown to PDF Studio</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; 
            margin: 0; display: flex; flex-direction: column; height: 100vh; 
            background: #ffffff; color: #000;
        }
        
        /* Navbar */
        nav { 
            background: #ffffff; padding: 0.8rem 1rem; display: flex; justify-content: space-between; 
            align-items: center; border-bottom: 2px solid #000; z-index: 100;
        }
        .controls { display: flex; gap: 10px; align-items: center; }
        .filename-input { padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; width: 140px; }
        .btn-download { background: #000; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; font-weight: 600; cursor: pointer; }

        /* Main Workspace */
        main { display: flex; flex: 1; overflow: hidden; }
        .pane { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        @media (max-width: 768px) {
            main { flex-direction: column; }
            .pane { flex: none; height: 50%; }
            .pane:first-child { border-bottom: 1px solid #ddd; }
        }

        .pane-header { padding: 6px 15px; background: #eee; font-size: 10px; font-weight: bold; border-bottom: 1px solid #ddd; }
        
        /* Editor Styles */
        textarea { 
            flex: 1; border: none; padding: 15px; font-family: monospace; font-size: 16px; 
            outline: none; resize: none; color: #000; background: #fff;
        }
        
        /* Preview Styles - Forced Black on White */
        #preview { 
            flex: 1; padding: 40px; overflow-y: auto; 
            background: #fff !important; color: #000 !important; 
        }

        /* Markdown Content Styling */
        #preview h1, #preview h2 { border-bottom: 1px solid #000; padding-bottom: 5px; color: #000 !important; }
        #preview p, #preview li { line-height: 1.6; color: #000 !important; }
        #preview table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        #preview th, #preview td { border: 1px solid #000; padding: 8px; color: #000 !important; }

        /* Pagination Control */
        #preview p, #preview li, #preview pre, #preview tr, #preview blockquote {
            page-break-inside: avoid;
            break-inside: avoid;
        }

        /* Utility: Hide from screen but keep for PDF engine */
        #offscreen-container {
            position: absolute;
            left: -9999px;
            top: 0;
            width: 800px; /* Fixed width for consistent layout */
        }

        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<nav class="no-print">
    <h1 style="margin:0; font-size: 1.1rem;">MD to PDF</h1>
    <div class="controls">
        <input type="text" id="filename" class="filename-input" value="document" placeholder="Filename">
        <button class="btn-download" onclick="exportPDF()">Save PDF</button>
    </div>
</nav>

<main>
    <div class="pane no-print">
        <div class="pane-header">Editor</div>
        <textarea id="editor" oninput="renderContent()" spellcheck="false" placeholder="Type here..."></textarea>
    </div>

    <div class="pane">
        <div class="pane-header no-print">Live Preview</div>
        <div id="preview"></div>
    </div>
</main>

<div id="offscreen-container"></div>

<script>
    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');
    const offscreen = document.getElementById('offscreen-container');

    function renderContent() {
        const html = marked.parse(editor.value);
        preview.innerHTML = html;
        // Sync the offscreen version for the PDF engine
        offscreen.innerHTML = `<div style="padding: 50px; background: white; color: black;">${html}</div>`;
    }

    async function exportPDF() {
        if (!editor.value.trim()) {
            alert("Please enter some text.");
            return;
        }

        const btn = document.querySelector('.btn-download');
        btn.innerText = "Working...";
        btn.disabled = true;

        const name = (document.getElementById('filename').value || 'document').trim();

        const options = {
            margin: [0.5, 0.5],
            filename: name + '.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { 
                scale: 2, 
                useCORS: true,
                logging: false,
                letterRendering: true,
                windowWidth: 800 // Forces desktop-width rendering
            },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
            pagebreak: { mode: ['css', 'legacy'] }
        };

        try {
            // We use the offscreen element to ensure visibility and dimensions
            await html2pdf().set(options).from(offscreen).save();
        } catch (err) {
            console.error("PDF Error:", err);
            alert("Export failed. Check console.");
        } finally {
            btn.innerText = "Save PDF";
            btn.disabled = false;
        }
    }

    // Initialize blank state
    renderContent();
</script>

</body>
</html>
