<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern MD 2 PDF</title>
    
    <script src="paged.polyfill.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <style>
        /* Professional Page Setup for PDF */
        @page {
            size: A4;
            margin: 25mm; /* Professional academic margin */
            @bottom-right {
                content: counter(page);
                font-family: sans-serif;
                font-size: 10pt;
            }
        }

        /* Standard Typography */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; }
        .markdown-body { padding: 20px; }
        pre { background: #f6f8fa; padding: 16px; border-radius: 6px; break-inside: avoid; }
        h1, h2, h3 { break-after: avoid; color: #222; }

        /* UI Styling (Hidden during Print) */
        #ui-wrapper { display: flex; height: 100vh; gap: 10px; padding: 10px; box-sizing: border-box; }
        #input { width: 50%; height: 100%; padding: 20px; border: 1px solid #ddd; resize: none; font-family: monospace; }
        #preview { width: 50%; overflow-y: auto; border: 1px solid #eee; background: white; }
        #controls { position: fixed; top: 20px; right: 40px; z-index: 1000; }
        
        button { 
            padding: 10px 20px; background: #2ea44f; color: white; 
            border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
        }

        /* Paged.js specific: Ensures UI doesn't break the PDF */
        @media print {
            #ui-wrapper, #controls { display: none !important; }
            .pagedjs_pages { background: white !important; }
        }
    </style>
</head>
<body>

    <div id="controls">
        <button onclick="window.print()">Export to PDF</button>
    </div>

    <div id="ui-wrapper">
        <textarea id="input" placeholder="Type Markdown..."></textarea>
        <div id="preview" class="markdown-body"></div>
    </div>

    <script>
        const input = document.getElementById('input');
        const preview = document.getElementById('preview');

        // Math Rendering Function
        function processMath(text) {
            // Block Math $$ ... $$
            text = text.replace(/\$\$([\s\S]+?)\$\$/g, (m, g1) => 
                katex.renderToString(g1, { displayMode: true }));
            // Inline Math $ ... $
            text = text.replace(/\$([^\n\s][^$\n]*?[^\n\s])\$/g, (m, g1) => 
                katex.renderToString(g1, { displayMode: false }));
            return text;
        }

        function update() {
            const html = marked.parse(input.value);
            preview.innerHTML = processMath(html);
        }

        input.addEventListener('input', update);

        // Default content
        input.value = "# Sample Document\n\nThis uses **Paged.js** for Puppeteer-like layouts.\n\n## Math\n$E = mc^2$\n\n$$\\int_a^b f(x)dx$$\n\n## Layout\nNotice that headers won't be separated from their paragraphs thanks to `break-after: avoid`.";
        update();
    </script>
</body>
</html>
